<html>
  <head>
    <title>Imgur roller</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <h1>Loading...</h1>
    <script type="text/javascript">
      const initBody = element => {
        document.body.innerHTML = ''
        document.body.appendChild(element)
      }

      const toDomNode = html => {
        const el = document.createElement('template');
        el.innerHTML = html;
        return document.importNode(el.content, true);
      }

      const createTextElement = text =>
        toDomNode(`<h1 style="font-size: 100pt; text-align: center; line-height: normal">${text}</h1>`)

      const createImageElement = src =>
        toDomNode(`<img style="height: ${window.innerHeight}px; width: 100%" src="${src}"/>`)

      const showImagesFromPage = pageNumber =>
        window.fetch(`https://api.imgur.com/3/gallery/r/brokengifs/time/${pageNumber}`, {
          headers: {
            'Authorization': 'Client-ID 1400c78269df7bc'
          }
        })
        .then(response => response.json())
        .then(responseBody => responseBody.data)
        .then(images => {
          if (images) doSlideShow(images, pageNumber)
          else if (pageNumber !== 0) showImagesFromPage(0)
          else createTextElement('Nothing to show :(')
        })
        .catch(e => {
          console.log(e)
          createTextElement('Error!')
        })

      const doSlideShow = (images, pageNumber) =>
        images
          .filter(isNotEditRequest)
          .map(toImageUrl)
          .reduce(toSlideShow, Promise.resolve())
          .then(() => showImagesFromPage(pageNumber + 1))

      const isNotEditRequest = imageData => !imageData.title.toLowerCase().includes('request')
      const toImageUrl = imageData => imageData.link.replace('http://', 'https://')
      const cleanUpImage = () => window.URL.revokeObjectURL(document.querySelector('img').src)

      const toSlideShow = (sequence, imageUrl) =>
        sequence
          .then(() => window.fetch(imageUrl))
          .then(response => response.blob())
          .then(window.URL.createObjectURL)
          .then(createImageElement)
          .then(initBody)
          .then(cleanUpImage)
          .then(pause)
          .catch(e => {
            console.log(e)
            return Promise.resolve()
          })

      const pause = () => new Promise(resolve => setTimeout(resolve, 3000))

      showImagesFromPage(0)
    </script>
  </body>
</html>